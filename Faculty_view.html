<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Faculty Name & Cabin Number Check</title>
<style>
  body { font-family: Arial, sans-serif; max-width: 600px; margin: 50px auto; text-align: center; padding: 10px; }
  label, select { font-size: 18px; margin: 15px 0; }
  select { padding: 10px; width: 80%; max-width: 400px; }
</style>
</head>
<body>

<h2>Select Faculty</h2>

<select id="facultySelect" disabled>
  <option value="">-- Select VIEW --</option>
  <option value="Faculty ">Faculty </option>
  <!-- <option value="Faculty 2">Faculty 2</option>
  <option value="Faculty 3">Faculty 3</option>
  <option value="Faculty 4">Faculty 4</option> -->
  <!-- Add more faculty names here as needed -->
</select>

<script>
  const facultySelect = document.getElementById('facultySelect');

  const CABIN_SHEET_CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQNGjtabub8Zn-7gjNkMIu2CybfxNy7NszHOoyjAx_ciFuMASBWywadgeoZ7wxcqXAkZFRpD7A1v4_N/pub?output=csv';

  // Use these URLs consistently here
  const FACULTY_NAME_FORM_URL = 'https://docs.google.com/forms/d/e/1FAIpQLSc9vhk-uylCRD16frrhuqB_GgxyMiLeJBpdKagLHBh8LSDZgA/viewform';
  const AVAILABILITY_FORM_URL = 'https://docs.google.com/forms/d/e/1FAIpQLSeLa8yyXrDRbDLpEDTToqpnHmK0w52p5AaxgRjf27TA21lruQ/viewform';

  let cabinData = {};

  function parseCSV(text) {
    const lines = text.trim().split('\n');
    return lines.map(line => {
      // Split by commas not in quotes, remove surrounding quotes
      return line.match(/(".*?"|[^",\s]+)(?=\s*,|\s*$)/g).map(cell => cell.replace(/^"|"$/g, '').trim());
    });
  }

  // Disable dropdown until data loads
  facultySelect.disabled = true;

  fetch(CABIN_SHEET_CSV_URL)
    .then(response => response.text())
    .then(csvText => {
      const rows = parseCSV(csvText);
      // Assuming columns: Timestamp, Faculty Name, Cabin Number (Faculty Name at index 1, Cabin Number at index 2)
      rows.slice(1).forEach(row => {
        const facultyName = row[1];
        const cabinNumber = row[2];
        if(facultyName && cabinNumber) {
          cabinData[facultyName.trim()] = cabinNumber.trim();
        }
      });
      facultySelect.disabled = false; // Enable dropdown after data is ready
    })
    .catch(error => {
      console.error("Error loading cabin data:", error);
      alert("Error loading cabin data. Please refresh the page.");
      facultySelect.disabled = false; // Enable to allow manual try
    });

  facultySelect.addEventListener('change', () => {
    const selectedFaculty = facultySelect.value.trim();
    if (!selectedFaculty) return;

    if (cabinData.hasOwnProperty(selectedFaculty)) {
      alert(`Welcome, ${selectedFaculty}.\nYour cabin number is: ${cabinData[selectedFaculty]}.\nRedirecting to availability update form.`);
      window.location.href = 'https://docs.google.com/forms/d/e/1FAIpQLSeLa8yyXrDRbDLpEDTToqpnHmK0w52p5AaxgRjf27TA21lruQ/viewform?usp=sharing&ouid=111286185584537034872';
    } else {
      alert(`Please fill/update your cabin number in the next form.`);
      window.location.href = 'https://docs.google.com/forms/d/e/1FAIpQLSc9vhk-uylCRD16frrhuqB_GgxyMiLeJBpdKagLHBh8LSDZgA/viewform?usp=sharing&ouid=111286185584537034872';
    }
  });
</script>

</body>
</html>
