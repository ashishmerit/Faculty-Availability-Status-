<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Faculty Availability Dashboard</title>
<style>
  body { font-family: Arial, sans-serif; max-width: 800px; margin: 50px auto; padding: 10px; }
  h1 { text-align: center; }
  table { width: 100%; border-collapse: collapse; margin-top: 20px; }
  th, td { padding: 10px; border: 1px solid #ddd; text-align: center; }
  th { background: #f5f5f5; }
  .status-Available { background-color: #d4edda; color: #155724; }
  .status-Busy { background-color: #fff3cd; color: #856404; }
  .status-InMeeting { background-color: #f8d7da; color: #721c24; }
  .status-Unknown { background-color: #e2e3e5; color: #6c757d; }
</style>
</head>
<body>

<h1>Faculty Availability Status</h1>
<table id="facultyTable" aria-label="Faculty Availability Table">
  <thead>
    <tr>
      <th>Faculty Name</th>
      <th>Cabin Number</th>
      <th>Availability Status</th>
      <th>Free Slot(s)</th>
      <th>Last Updated</th>
    </tr>
  </thead>
  <tbody>
    
  </tbody>
</table>

<script>

const CABIN_SHEET_CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQNGjtabub8Zn-7gjNkMIu2CybfxNy7NszHOoyjAx_ciFuMASBWywadgeoZ7wxcqXAkZFRpD7A1v4_N/pub?output=csv';
const AVAILABILITY_SHEET_CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQXRimJYd9pYsaa4_PrfVY2hLCCYy1nuCIrSRHe5e_uPRUIBwfe5dXFSOzfblXsUwHjsUyiVQpXoJfO/pub?output=csv';

function parseCSV(text) {
  const lines = text.trim().split('\n');
  return lines.map(line => 
    line.match(/(".*?"|[^",\s]+)(?=\s*,|\s*$)/g).map(cell => cell.replace(/^"|"$/g, '').trim())
  );
}

function formatTimestamp(ts) {
  if (!ts) return '';
  const date = new Date(ts);
  if (isNaN(date)) return ts;
  return date.toLocaleString();
}

Promise.all([
  fetch(CABIN_SHEET_CSV_URL).then(r => r.text()),
  fetch(AVAILABILITY_SHEET_CSV_URL).then(r => r.text())
]).then(([cabinCSV, availabilityCSV]) => {
  const cabinRows = parseCSV(cabinCSV);
  const availabilityRows = parseCSV(availabilityCSV);

  
  const cabinMap = {};
  cabinRows.slice(1).forEach(row => {
    const name = row[1] || '';
    const cabin = row[2] || '';
    if(name) cabinMap[name.trim()] = cabin.trim();
  });

  
  const availabilityMap = {};
  for (let i = availabilityRows.length - 1; i > 0; i--) {
    const row = availabilityRows[i];
    const timestamp = row[0];
    const name = row[3] || '';
    const status = row[1] || '';
    const freeSlots = row[2] || '';
    if (name && !availabilityMap.hasOwnProperty(name.trim())) {
      availabilityMap[name.trim()] = { status, freeSlots, timestamp };
    }
  }

  const tableBody = document.querySelector('#facultyTable tbody');
  Object.keys(cabinMap).forEach(faculty => {
    const cabin = cabinMap[faculty] || 'N/A';
    const avail = availabilityMap[faculty];
    let statusText = 'Unknown', freeSlotsText = 'N/A', timestampText = '';
    if (avail) {
      statusText = avail.status || 'Unknown';
      freeSlotsText = avail.freeSlots || 'N/A';
      timestampText = formatTimestamp(avail.timestamp);
    }
    const statusClass = 'status-' + statusText.replace(/\s+/g, '');

    const row = document.createElement('tr');
    row.innerHTML = `
      <td>${faculty}</td>
      <td>${cabin}</td>
      <td class="${statusClass}">${statusText}</td>
      <td>${freeSlotsText}</td>
      <td>${timestampText}</td>
    `;
    tableBody.appendChild(row);
  });

}).catch(err => {
  console.error('Error loading sheets:', err);
  document.body.insertAdjacentHTML('beforeend', '<p style="color:red;">Failed to load faculty availability data. Please try again later.</p>');
});
</script>

</body>
</html>

